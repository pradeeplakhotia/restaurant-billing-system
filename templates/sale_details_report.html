{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-6 offset-md-3">
        <h2 class="mb-4 text-center">Sale Details Report</h2>

        <div class="card p-4">
            <div class="form-group mb-3">
                <label for="start_date">Start Date:</label>
                <input type="date" id="start_date" class="form-control" required>
            </div>

            <div class="form-group mb-3">
                <label for="end_date">End Date:</label>
                <input type="date" id="end_date" class="form-control" required>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <button class="btn btn-primary me-md-2" onclick="generateReport('summary')">Summary Report</button>
                <button class="btn btn-success" onclick="generateReport('details')">Details Report</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Set default dates to today
    document.addEventListener('DOMContentLoaded', function () {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start_date').value = today;
        document.getElementById('end_date').value = today;
    });

    function generateReport(type) {
        const startDate = document.getElementById('start_date').value;
        const endDate = document.getElementById('end_date').value;

        if (!startDate || !endDate) {
            alert("Please select both start and end dates.");
            return;
        }

        fetch('/generate_sale_details_report', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                type: type,
                start_date: startDate,
                end_date: endDate
            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.open(data.pdf_url, '_blank');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('An error occurred while generating the report.');
            });
    }
</script>
{% endblock %}